class ModalManager{constructor(e={}){this.options={closeOnEscape:!0,closeOnOutsideClick:!0,modalSelector:".modal-wrapper",modalTriggerAttribute:"data-modal",closeButtonSelector:".modal-close",baseZIndex:1e3,...e},this.openModals=[],this.lastFocusedElement=null,this.handleCloseButtonMouseDown=this.handleCloseButtonMouseDown.bind(this),this.handleTriggerClick=this.handleTriggerClick.bind(this),this.handleBackgroundMouseDown=this.handleBackgroundMouseDown.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.init()}init(){document.addEventListener("mousedown",this.handleCloseButtonMouseDown,!0),document.addEventListener("mousedown",this.handleBackgroundMouseDown,!0),document.addEventListener("click",this.handleTriggerClick),this.options.closeOnEscape&&document.addEventListener("keydown",this.handleKeyDown)}handleCloseButtonMouseDown(e){if(e.target.matches(this.options.closeButtonSelector)||e.target.closest(this.options.closeButtonSelector)){const t=e.target.closest(this.options.modalSelector);if(t&&t.id&&this.isOpen(t.id))return e.preventDefault(),e.stopPropagation(),this.close(t.id),!1}}handleBackgroundMouseDown(e){if(this.options.closeOnOutsideClick&&e.target.matches(this.options.modalSelector)){const t=e.target.id,o=e.clientX,n=e.clientY;if(!Array.from(e.target.children).some((e=>{const t=e.getBoundingClientRect();return o>=t.left&&o<=t.right&&n>=t.top&&n<=t.bottom}))&&t&&this.isOpen(t))return e.preventDefault(),e.stopPropagation(),this.close(t),!1}}handleTriggerClick(e){const{target:t}=e;if(t.hasAttribute(this.options.modalTriggerAttribute)||t.closest(`[${this.options.modalTriggerAttribute}]`)){e.preventDefault();const o=(t.hasAttribute(this.options.modalTriggerAttribute)?t:t.closest(`[${this.options.modalTriggerAttribute}]`)).getAttribute(this.options.modalTriggerAttribute);this.open(o)}}handleKeyDown(e){if("Escape"===e.key&&this.openModals.length>0){e.preventDefault();const t=this.openModals[this.openModals.length-1];this.close(t)}"Tab"===e.key&&this.openModals.length>0&&this.handleTabKey(e)}handleTabKey(e){if(0===this.openModals.length)return;const t=this.openModals[this.openModals.length-1],o=document.getElementById(t);if(!o)return;const n=this.getFocusableElements(o);if(0===n.length)return;const s=n[0],i=n[n.length-1];e.shiftKey&&document.activeElement===s?(e.preventDefault(),i.focus()):e.shiftKey||document.activeElement!==i||(e.preventDefault(),s.focus())}getFocusableElements(e){return Array.from(e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter((e=>!e.hasAttribute("disabled")&&"none"!==e.style.display))}open(e){const t=document.getElementById(e);if(!t||this.isOpen(e))return;this.lastFocusedElement=document.activeElement,this.openModals.push(e),t.style.zIndex=this.options.baseZIndex+this.openModals.length,t.style.display="block",t.setAttribute("aria-hidden","false"),document.body.classList.add("modal-open");const o=this.getFocusableElements(t);o.length>0&&setTimeout((()=>{o[0].focus()}),100),t.dispatchEvent(new CustomEvent("modal:open",{bubbles:!0,detail:{modalId:e}}))}close(e){const t=document.getElementById(e);if(!t||!this.isOpen(e))return;const o=this.openModals.indexOf(e);if(-1!==o&&this.openModals.splice(o,1),t.style.display="none",t.setAttribute("aria-hidden","true"),0===this.openModals.length&&document.body.classList.remove("modal-open"),0===this.openModals.length&&this.lastFocusedElement)this.lastFocusedElement.focus(),this.lastFocusedElement=null;else if(this.openModals.length>0){const e=this.openModals[this.openModals.length-1],t=document.getElementById(e);if(t){const e=this.getFocusableElements(t);e.length>0&&e[0].focus()}}t.dispatchEvent(new CustomEvent("modal:close",{bubbles:!0,detail:{modalId:e}}))}closeAll(){[...this.openModals].forEach((e=>this.close(e)))}isOpen(e){return this.openModals.includes(e)}getOpenModals(){return[...this.openModals]}getActiveModal(){return 0===this.openModals.length?null:this.openModals[this.openModals.length-1]}destroy(){document.removeEventListener("mousedown",this.handleCloseButtonMouseDown,!0),document.removeEventListener("mousedown",this.handleBackgroundMouseDown,!0),document.removeEventListener("click",this.handleTriggerClick),document.removeEventListener("keydown",this.handleKeyDown),this.closeAll(),this.openModals=[]}}!function(){function e(){window.modalManager=new ModalManager}"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e())}(),"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=ModalManager);